<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simulating Single-Item Inventory Systems</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="/css/tufte.css" type="text/css" />
<link rel="stylesheet" href="/css/ox-tufte.css" type="text/css" />
<link rel="stylesheet" href="/css/pygments.css" type="text/css" />
          <style>
          /* From: https://endlessparentheses.com/public/css/endless.css */
          /* See also: https://meta.superuser.com/questions/4788/css-for-the-new-kbd-style */
          kbd
          {
            -moz-border-radius: 6px;
            -moz-box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
            -webkit-border-radius: 6px;
            -webkit-box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
            background-color: #f7f7f7;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
            color: #333;
            display: inline-block;
            font-family: 'Droid Sans Mono', monospace;
            font-size: 80%;
            font-weight: normal;
            line-height: inherit;
            margin: 0 .1em;
            padding: .08em .4em;
            text-shadow: 0 1px 0 #fff;
            word-spacing: -4px;
        
            box-shadow: 2px 2px 2px #222; /* MA: An extra I've added. */
          }
          </style>
          <link rel="stylesheet" type="text/css" href="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/css/tooltipster.bundle.min.css"/>
        
          <link rel="stylesheet" type="text/css" href="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-punk.min.css" />
        
          <script type="text/javascript">
              if (typeof jQuery == 'undefined') {
                  document.write(unescape('%3Cscript src="https://code.jquery.com/jquery-1.10.0.min.js"%3E%3C/script%3E'));
              }
          </script>
        
           <script type="text/javascript"            src="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/js/tooltipster.bundle.min.js"></script>
        
            <script>
                   $(document).ready(function() {
                       $('.tooltip').tooltipster({
                           theme: 'tooltipster-punk',
                           contentAsHTML: true,
                           animation: 'grow',
                           delay: [100,500],
                           // trigger: 'click'
                           trigger: 'custom',
                           triggerOpen: {
                               mouseenter: true
                           },
                           triggerClose: {
                               originClick: true,
                               scroll: true
                           }
           });
                   });
               </script>
        
          <style>
             abbr {color: red;}
        
             .tooltip { border-bottom: 1px dotted #000;
                        color:red;
                        text-decoration: none;}
          </style>
          
          <style>
          /* From: https://endlessparentheses.com/public/css/endless.css */
          /* See also: https://meta.superuser.com/questions/4788/css-for-the-new-kbd-style */
          kbd
          {
            -moz-border-radius: 6px;
            -moz-box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
            -webkit-border-radius: 6px;
            -webkit-box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
            background-color: #f7f7f7;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
            color: #333;
            display: inline-block;
            font-family: 'Droid Sans Mono', monospace;
            font-size: 80%;
            font-weight: normal;
            line-height: inherit;
            margin: 0 .1em;
            padding: .08em .4em;
            text-shadow: 0 1px 0 #fff;
            word-spacing: -4px;
        
            box-shadow: 2px 2px 2px #222; /* MA: An extra I've added. */
          }
          </style>
          <link rel="stylesheet" type="text/css" href="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/css/tooltipster.bundle.min.css"/>
        
          <link rel="stylesheet" type="text/css" href="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-punk.min.css" />
        
          <script type="text/javascript">
              if (typeof jQuery == 'undefined') {
                  document.write(unescape('%3Cscript src="https://code.jquery.com/jquery-1.10.0.min.js"%3E%3C/script%3E'));
              }
          </script>
        
           <script type="text/javascript"            src="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/js/tooltipster.bundle.min.js"></script>
        
            <script>
                   $(document).ready(function() {
                       $('.tooltip').tooltipster({
                           theme: 'tooltipster-punk',
                           contentAsHTML: true,
                           animation: 'grow',
                           delay: [100,500],
                           // trigger: 'click'
                           trigger: 'custom',
                           triggerOpen: {
                               mouseenter: true
                           },
                           triggerClose: {
                               originClick: true,
                               scroll: true
                           }
           });
                   });
               </script>
        
          <style>
             abbr {color: red;}
        
             .tooltip { border-bottom: 1px dotted #000;
                        color:red;
                        text-decoration: none;}
          </style>
<script>
  window.MathJax = {
    tex: {
      macros: {
        argmin: ["\\mathop{\\mathrm{arg\\,min}}", 0],
        argmax: ["\\mathop{\\mathrm{arg\\,max}}", 0],
        abs: ["\\left\\vert#1\\right\\vert", 1],
        given: ["\\,\\middle|\\,", 0],
        mineq: "\\mathrel{-}=",
        pluseq: "\\mathrel{+}=",
        supp: ["\\mathrm{supp}\\left(#1\\right)", 1],
        Max: ["\\max\\left\\{#1\\right\\}", 1],
        Min: ["\\min\\left\\{#1\\right\\}", 1],
        Inf: ["\\inf\\left\\{#1\\right\\}", 1],
        IInf: ["\\displaystyle\\mathop{\\inf}_{#1}\\left\\{#2\\right\\}", 2],
        Sup: ["\\sup\\left\\{#1\\right\\}", 1],
        SSup: ["\\displaystyle\\mathop{\\sup}_{#1}\\left\\{#2\\right\\}", 2],
        As: "\\tilde{A}",
        B: "\\mathbb{B}",
        C: "\\mathcal{C}",
        d: "\\,\\textrm{d}",
        E: ["\\mathsf{E}\\left[#1\\right]", 1],
        F: "\\mathcal{F}",
        IL: "I",
        IP: "P",
        leadtime: "l",
        N: "\\mathbb{N}",
        P: ["\\mathsf{P}\\left\\{#1\\right\\}", 1],
        R: "\\mathbb{R}",
        V: ["\\mathsf{V}\\left[#1\\right]", 1],
        Z: "\\mathbb{Z}",
        Bin: ["\\mathrm{Bin}(#1)", 1],
        Exp: ["\\mathrm{Exp}(#1)", 1],
        FS: ["\\mathrm{FS}(#1)", 1],
        Gamm: ["\\mathrm{Gamm}(#1)", 1],
        Geo: ["\\mathrm{Geo}(#1)", 1],
        HGeom: ["\\mathrm{HGeom}(#1)", 1],
        Norm: ["\\mathrm{Norm}(#1)", 1],
        Pois: ["\\mathrm{Pois}(#1)", 1],
        Unif: ["\\mathrm{Unif}(#1)", 1],
        "1": ["\\mathbb{1}\\left\\{#1\\right\\}", 1],
      },
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<header id="preamble" class="status">
<header class='site-header'>
  <div class='site-header-container'>
    <a href="https://ndvanforeest.github.io/">
    <img src="/img/harry.jpg" alt='parsec logo' class='site-logo'>
    </a>
      <div class='site-title-container'>
        <h1 class='site-title'>Nicky&rsquo;s site</h1>
      </div>
    </div>
</header>
<hr class='menu-divider'>
<nav class='menu'>
  <ul>
    <li><a href='/index.html'>Home</a></li>
    <li><a href='/about_this_site.html'>About this site</a></li>
    <li><a href='/bio.html'>Bio</a></li>
    <li><a href='/books.html'>Books</a></li>
    <li><a href='/city_walks.html'>Stadswandelingen</a></li>
    <li><a href='/stochastic_or.html'>Stochastic OR</a></li>
  </ul>
</nav>
<hr class='menu-divider'>
</header>
<article id="content" class="content">
<section id="outline-container-sec:simul-invent-syst" class="outline-2">
<h2 id="sec:simul-invent-syst"><span class="section-number-2">1.</span> Simulating Single-Item Inventory Systems</h2>
<div class="outline-text-2" id="text-sec:simul-invent-syst">
<p>
In this section, we develop a simulation environment to analyze a single-item inventory system under periodic review controlled by an \((s,S)\) policy.
</p>


<p>
<strong style="font-variant: all-small-caps">The Lighthouse Company</strong> sells ceiling lamps and, since the replenishment cost \(K=50\) euro is relatively high, it considers using an \((s,S)\) policy to control the inventory.
The company wants to use simulation to find sound values for \(s\) and \(S\).
</p>

<p>
The details of the case are as follows.
Ceiling lamps sell for 100 euro, while the purchase price is 40 euro.
The monthly holding cost is estimated at 50% of the purchase price.
To prevent customers from buying from a competitor (e.g., online), the Lighthouse Company offers a discount of 20% per day on the regular selling price when demand cannot be met from on-hand stock.
The pmf \(f_{i} = \P{D=i}\) of daily demand is given by
</p>
\begin{align*}
  f_{0} &= 1/6, &   f_{1} &= 1/5, &  f_{2}&= 1/4, &
  f_{3} &= 1/8, &  f_{4} &= 11/120, &  f_{5} &= 1/6.
\end{align*}
<p>
The lead time \(\leadtime=2\) days.
</p>

<p>
Here are the model parameters.
The daily demand is a <code class="src src-python">RV</code>.
The cost parameters must have consistent units; here we convert costs to a per-day basis.
</p>

<div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Lighthouse case: model parameters.&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random_variable</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rv</span>

<span class="n">D</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">RV</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">11</span> <span class="o">/</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">6</span><span class="p">})</span>

<span class="n">l</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># lead time</span>
<span class="n">h</span> <span class="o">=</span> <span class="mi">40</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="mi">30</span>  <span class="c1"># daily holding cost</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="mf">0.2</span>  <span class="c1"># daily backlog cost</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># Order cost, used for sS and Qr</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># simulation duration</span>

<span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="n">l</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The simulation duration </span><span class="si">{</span><span class="n">N</span><span class="si">=}</span><span class="s2"> is shorter than the lead time </span><span class="si">{</span><span class="n">l</span><span class="si">=}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">quit</span><span class="p">()</span>
</pre></div>


<p>
<strong style="font-variant: all-small-caps">With the code</strong> below, we set up a simulation to estimate the performance measures for one specific \((s,S)\) policy.
For the KPIs we introduce two general helper functions, and write these to the file <code class="src src-python">functions.py</code>.
By importing this file, we can use these functions at other places, just like the <code class="src src-python">RV</code> class.
</p>


<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>


<span class="k">def</span><span class="w"> </span><span class="nf">Plus</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Plus</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">Min</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">Plus</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Plus</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>
</pre></div>

<p>
We now proceed with the inventory model.
Most of the following modules should be familiar.
The last module loads the <code class="src src-python">RV</code> class, which was discussed in \cref{sec:prob_arithmetic}.
</p>

<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy.random</span><span class="w"> </span><span class="kn">import</span> <span class="n">default_rng</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">random_variable</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rv</span>
<span class="kn">from</span><span class="w">  </span><span class="nn">functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Plus</span><span class="p">,</span> <span class="n">Min</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">lighthouse_case</span><span class="w"> </span><span class="kn">import</span> <span class="n">D</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">b</span>
</pre></div>


<p>
This function computes, for the demand <code class="src src-python">D</code>, the inventory positions and inventory levels under specified <code class="src src-python">s</code> and <code class="src src-python">S</code>.
For the inventory levels, we combine \cref{eq:i5} into one recursion.
The first <code class="src src-python"><span style="font-weight: bold;">for</span></code> loop for the inventory levels computes the levels for \(t < \leadtime\), since no replenishments occur in those periods.
</p>
<div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">simulate_sS</span><span class="p">(</span><span class="n">demands</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># inventory position</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># order quantities</span>
    <span class="n">IL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># inventory level</span>
    <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">IL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span>  <span class="c1"># initial values</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="n">Pprime</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">demands</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">Q</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span> <span class="o">-</span> <span class="n">Pprime</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Pprime</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="p">)</span>
        <span class="n">P</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pprime</span> <span class="o">+</span> <span class="n">Q</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
        <span class="n">IL</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">IL</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">demands</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">N</span><span class="p">):</span>
        <span class="n">IL</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">IL</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">demands</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">Q</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="n">l</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">P</span><span class="p">,</span> <span class="n">IL</span><span class="p">,</span> <span class="n">Q</span>
</pre></div>

<p>
For the service levels, the cycle service level \(\alpha_{c}\) is of particular interest; we compute it using slicing, a common Python technique.<label id='fnr.1' for='fnr-in.1.362816' class='margin-toggle sidenote-number'><sup class='numeral'>1</sup></label><input type='checkbox' id='fnr-in.1.362816' class='margin-toggle'><span class='sidenote'><sup class='numeral'>1</sup>
Ask ChatGPT for explanation if you find this line hard. I found it hard to get it right.
</span>
</p>
<div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">cost</span><span class="p">(</span><span class="n">IL</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">K</span> <span class="o">*</span> <span class="p">(</span><span class="n">Q</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="n">Plus</span><span class="p">(</span><span class="n">IL</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">Min</span><span class="p">(</span><span class="n">IL</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">alpha</span><span class="p">(</span><span class="n">IL</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">IL</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">beta</span><span class="p">(</span><span class="n">demands</span><span class="p">,</span> <span class="n">IL</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">demands</span><span class="p">,</span> <span class="n">Plus</span><span class="p">(</span><span class="n">IL</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">demands</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">alpha_c</span><span class="p">(</span><span class="n">IL</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">Q</span><span class="p">[:</span><span class="o">-</span><span class="n">l</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">IL</span><span class="p">[</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">Q</span><span class="p">[:</span><span class="o">-</span><span class="n">l</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

<p>
We can now run a simulation to compute the KPIs.
</p>
<div class="highlight"><pre><span></span><span class="n">rng</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># set the seed</span>
<span class="n">demands</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="n">P</span><span class="p">,</span> <span class="n">IL</span><span class="p">,</span> <span class="n">Q</span> <span class="o">=</span> <span class="n">simulate_sS</span><span class="p">(</span><span class="n">demands</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">demands</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">P</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">IL</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">Q</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Plus</span><span class="p">(</span><span class="n">IL</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">Min</span><span class="p">(</span><span class="n">IL</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cost</span><span class="p">(</span><span class="n">IL</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">)</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">alpha</span><span class="p">(</span><span class="n">IL</span><span class="p">)</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">beta</span><span class="p">(</span><span class="n">demands</span><span class="p">,</span><span class="w"> </span><span class="n">IL</span><span class="p">)</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">alpha_c</span><span class="p">(</span><span class="n">IL</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">)</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">demands</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">=</span><span class="mf">2.32</span><span class="p">,</span> <span class="n">P</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">=</span><span class="mf">13.11</span><span class="p">,</span> <span class="n">IL</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">=</span><span class="mf">8.64</span><span class="p">,</span> <span class="n">Q</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">=</span><span class="mf">2.32</span>
<span class="n">Plus</span><span class="p">(</span><span class="n">IL</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">=</span><span class="mf">8.71</span><span class="p">,</span> <span class="n">Min</span><span class="p">(</span><span class="n">IL</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">=</span><span class="mf">0.07</span>
<span class="n">cost</span><span class="p">(</span><span class="n">IL</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span><span class="o">=</span><span class="mf">13.71</span>
<span class="n">alpha</span><span class="p">(</span><span class="n">IL</span><span class="p">)</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">beta</span><span class="p">(</span><span class="n">demands</span><span class="p">,</span> <span class="n">IL</span><span class="p">)</span><span class="o">=</span><span class="mf">0.88</span><span class="p">,</span> <span class="n">alpha_c</span><span class="p">(</span><span class="n">IL</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span><span class="o">=</span><span class="mf">0.67</span>
</pre></div>


<p>
<strong style="font-variant: all-small-caps">It remains to</strong> find good policy parameters.
In principle, this is simple: vary <code class="src src-python">s</code> and <code class="src src-python">S</code> over a range of values to find the cost-minimizing combination.<label id='fnr.2' for='fnr-in.2.8791831' class='margin-toggle sidenote-number'><sup class='numeral'>2</sup></label><input type='checkbox' id='fnr-in.2.8791831' class='margin-toggle'><span class='sidenote'><sup class='numeral'>2</sup>
Finding the optimal \(s\) and \(S\) efficiently is not an easy problem.
If you are interested, consult me for details.
</span>
For this we can use the next general grid search algorithm, which we store in <code class="src src-python">function.py</code>; below we apply it to our case
</p>

<div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">grid_search</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="s2">&quot;Minimize a f on the grid.&quot;</span>
    <span class="n">best_x</span><span class="p">,</span> <span class="n">best_value</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">grid</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="c1"># allow unpacking *x for non-iterable x</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">best_value</span><span class="p">:</span>
            <span class="n">best_x</span><span class="p">,</span> <span class="n">best_value</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">best_x</span><span class="p">,</span> <span class="n">best_value</span>
</pre></div>

<p>
The results show that the best \(s\) and \(S\) lie in the search area.
This <i>suggests</i> they are optimal.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">cost_of</span><span class="p">(</span><span class="n">demands</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
    <span class="n">P</span><span class="p">,</span> <span class="n">IL</span><span class="p">,</span> <span class="n">Q</span> <span class="o">=</span> <span class="n">simulate_sS</span><span class="p">(</span><span class="n">demands</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cost</span><span class="p">(</span><span class="n">IL</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">grid_search</span>

<span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">S</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
<span class="p">(</span><span class="n">s_opt</span><span class="p">,</span> <span class="n">S_opt</span><span class="p">),</span> <span class="n">V</span> <span class="o">=</span> <span class="n">grid_search</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">S</span><span class="p">:</span> <span class="n">cost_of</span><span class="p">(</span><span class="n">demands</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">S</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s_opt</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">S_opt</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">V</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">s_opt</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">S_opt</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">V</span><span class="o">=</span><span class="mf">13.00</span>
</pre></div>


<div style="padding: 0.5em;;background-color: #CCFFCC;border-radius: 15px;font-size: 1em"> <b>Exercise 1:</b> 
<p>
What inventory policy does the following code try to implement; what is wrong; and what are its policy parameters?
</p>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">gen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">l</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">Q_size</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">s</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">labda</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">labda</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)):</span>
    <span class="n">Q</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">P</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">Q</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">D</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

<span class="n">IL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)):</span>
    <span class="n">IL</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">IL</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">Q</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="n">l</span><span class="p">]</span> <span class="o">-</span> <span class="n">D</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
</pre></div>

<details class="code-details"
                 style ="padding: 1em;
                          background-color: #e5f5e5;
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="green">
                         Solution
                      </font>
                    </strong>
                  </summary>
<div style="padding: 0.5em;;background-color: #CCFFCC;border-radius: 15px;font-size: 1em"> <b>Did you actually try? Maybe see the ‘hints’ above!:</b> 
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #e5f5e5;
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="red">
                         Solution, for real
                      </font>
                    </strong>
                  </summary>
<p>
The \((Q,r)\) policy with \(Q=10\) and \(r=s=20\).
However, this version is correct; the loop in the problem statement is wrong.
</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)):</span>
    <span class="n">Pprime</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">D</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">Q</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">Pprime</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">P</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">Q</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">D</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
</pre></div>


</details>
</div>

</details>
</div>
<p>
<a href="https://creativecommons.org/licenses/by-sa/4.0/"><img alt="CC BY-SA 4.0" style="height:1.2em; vertical-align:middle;" src="https://licensebuttons.net/l/by-sa/4.0/88x31.png" /></a>
This work is licensed by the University of Groningen under a
<a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
</p>
</div>
</section>
</article>
<footer id="postamble" class="status">
<hr> <p class="footer"> &#8226; A site by Nicky van Foreest &#8226;   Last updated: 2022:05:07, Generated with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 30.2 (<a href="https://orgmode.org">Org</a> mode 9.7.11)</p>
</footer>
</body>
</html>
